{"version":3,"names":[],"sources":["Draggable.svelte"],"sourcesContent":["<script lang=\"ts\">;\n;\n;\nimport { PIN_INPUT, PIN_OUTPUT } from \"@ide/models/Pin\";\nimport { drawnConnection, connections } from \"@ide/store\";\nimport { GenerateGUID } from \"@ide/utils/random\";\nimport { onMount } from \"svelte\";\nimport { derived, get } from \"svelte/store\";\n;\nconst snapping = 1;\nexport let tile;\nexport let scaling = 1;\nexport let offsetX = 0;\nexport let offsetY = 0;\nlet self;\nlet dragging = false;\nlet startX = 0;\nlet startY = 0;\nlet startPageX = 0;\nlet startPageY = 0;\nconst pinBindings = {};\nonMount(() => {\n    // TODO Make not ugly\n    self.ide_component = tile;\n    tile.update((t) => {\n        return {\n            ...t,\n            metadata: {\n                ...t.metadata,\n                component: self,\n                pinComponents: pinBindings,\n            },\n        };\n    });\n});\nfunction handleDragStart(event) {\n    dragging = true;\n    startX = event.clientX - self.offsetLeft;\n    startY = event.clientY - self.offsetTop;\n    startPageX = event.pageX;\n    startPageY = event.pageY;\n}\nfunction handleMouseMove(event) {\n    if (dragging) {\n        const newX = startPageX - startX + ((event.pageX - startPageX) / scaling);\n        const newY = startPageY - startY + ((event.pageY - startPageY) / scaling);\n        tile.update((t) => {\n            return {\n                ...t,\n                metadata: {\n                    ...t.metadata,\n                    position: {\n                        x: newX - (newX % snapping),\n                        y: newY - (newY % snapping),\n                    },\n                },\n            };\n        });\n    }\n}\nfunction drawConnection(pin) {\n    const connection = {\n        metadata: {\n            id: GenerateGUID(),\n        },\n    };\n    if (pin.position === PIN_OUTPUT) {\n        connection.sourceTile = {\n            tile,\n            pin,\n        };\n    }\n    else {\n        connection.targetTile = {\n            tile,\n            pin,\n        };\n    }\n    drawnConnection.set(connection);\n    tile.update((t) => {\n        return {\n            ...t,\n            metadata: {\n                ...t.metadata,\n                pinConnections: {\n                    ...t.metadata.pinConnections,\n                    [pin.name]: connection,\n                },\n            },\n        };\n    });\n}\nfunction releaseMouse(pin) {\n    // TODO Remove cast on svelte version >= 3.30\n    const connection = get(drawnConnection);\n    if (!connection) {\n        return;\n    }\n    if (connection.sourceTile && pin.position === PIN_INPUT) {\n        connection.targetTile = {\n            tile,\n            pin,\n        };\n    }\n    else if (connection.targetTile && pin.position === PIN_OUTPUT) {\n        connection.sourceTile = {\n            tile,\n            pin,\n        };\n    }\n    drawnConnection.set(undefined);\n    if (connection.sourceTile && connection.targetTile) {\n        connections.add(connection);\n        tile.update((t) => {\n            return {\n                ...t,\n                metadata: {\n                    ...t.metadata,\n                    pinConnections: {\n                        ...t.metadata.pinConnections,\n                        [pin.name]: connection,\n                    },\n                },\n            };\n        });\n    }\n    else {\n        const otherTile = connection.sourceTile || connection.targetTile;\n        otherTile.tile.update((t) => {\n            return {\n                ...t,\n                metadata: {\n                    ...t.metadata,\n                    pinConnections: {\n                        ...t.metadata.pinConnections,\n                        [otherTile.pin.name]: undefined,\n                    },\n                },\n            };\n        });\n    }\n}\n</script>\n\n<style lang=\"scss\">.Draggable {\n  width: 400px;\n  position: absolute;\n  user-select: none;\n  cursor: auto;\n}\n.Draggable.Dragging {\n  z-index: 1;\n}\n.Draggable.Dragging .Header {\n  cursor: grabbing;\n}\n.Draggable .Header {\n  background: #ab400d;\n  cursor: grab;\n  padding: 10px;\n}\n.Draggable .Body {\n  background: #171717;\n  display: flex;\n  flex: 1;\n  flex-direction: row;\n  padding: 10px;\n}\n.Draggable .Body .Inputs, .Draggable .Body .Outputs {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  gap: 10px;\n  align-items: flex-start;\n}\n.Draggable .Body .Outputs {\n  align-items: flex-end;\n}\n.Draggable .Body .Outputs .Point {\n  margin-right: 0;\n  margin-left: 5px;\n}\n.Draggable .Body .Pin {\n  display: flex;\n  flex: 1;\n  flex-direction: row;\n  line-height: 15px;\n  cursor: pointer;\n}\n.Draggable .Body .Pin .Point {\n  width: 12px;\n  height: 12px;\n  border-radius: 12px;\n  border: 2px solid white;\n  margin-right: 5px;\n}\n.Draggable .Metadata {\n  background: #2e1111;\n  padding: 10px;\n}</style>\n\n<svelte:window\n  on:mousemove={handleMouseMove}\n  on:mouseup={() => (dragging = false)} />\n\n<div\n  class=\"Draggable panzoom-exclude\"\n  style=\"top: {$tile.metadata.position.y}px; left: {$tile.metadata.position.x}px\"\n  bind:this={self}\n  class:Dragging={dragging === true}>\n  <div class=\"Header\" on:mousedown={handleDragStart}>\n    <span>{$tile.definition.name}</span>\n  </div>\n  <div class=\"Body\">\n    <div class=\"Inputs\">\n      {#each Object.entries($tile.definition.pins) as [name, pin], i}\n        {#if pin.position === PIN_INPUT}\n          <div\n            class=\"Pin\"\n            on:mousedown={() => drawConnection(pin)}\n            on:mouseup={() => releaseMouse(pin)}>\n            <div bind:this={pinBindings[pin.name]} class=\"Point\" />\n            <span>{pin.name}</span>\n          </div>\n        {/if}\n      {/each}\n    </div>\n    <div class=\"Outputs\">\n      {#each Object.entries($tile.definition.pins) as [name, pin], i}\n        {#if pin.position === PIN_OUTPUT}\n          <div\n            class=\"Pin\"\n            on:mousedown={() => drawConnection(pin)}\n            on:mouseup={() => releaseMouse(pin)}>\n            <span>{pin.name}</span>\n            <div bind:this={pinBindings[pin.name]} class=\"Point\" />\n          </div>\n        {/if}\n      {/each}\n    </div>\n  </div>\n  <div class=\"Metadata\">\n    <span>ID: {$tile.metadata.id}</span><br />\n    <span>Position: X: {$tile.metadata.position.x}, Y: {$tile.metadata.position.y}</span>\n  </div>\n</div>\n"],"mappings":"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"}