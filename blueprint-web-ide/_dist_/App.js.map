{"version":3,"names":[],"sources":["App.svelte"],"sourcesContent":["<script context=\"module\">import * as BaseDefinitions from \"./definitions\";\nimport * as LanguageDefinitions from \"./languages\";\nimport { RegisterTileDefinition } from \"./models/TileDefinition\";\nimport { RegisterLanguageTileDefinition } from \"./models/LanguageTileDefinition\";\nObject.values(BaseDefinitions).forEach((definition) => {\n    RegisterTileDefinition(definition);\n});\nObject.entries(LanguageDefinitions).forEach(([language, definitions]) => {\n    Object.values(definitions).forEach((definition) => {\n        RegisterLanguageTileDefinition(language, definition);\n    });\n});\n</script>\n\n<script lang=\"ts\">import Draggable from \"./components/Draggable.svelte\";\nimport DrawingConnection from \"./components/DrawingConnection.svelte\";\nimport Connection from \"./components/Connection.svelte\";\n;\n;\n;\n;\n;\nimport { GenerateGUID } from \"./utils/random\";\nimport { GetTileDefinition } from \"./models/TileDefinition\";\nimport { tiles, connections, drawnConnection } from \"@ide/store\";\nimport { derived, get, writable } from \"svelte/store\";\nimport { Compile } from \"./engine/transpiler\";\nimport { onMount } from \"svelte\";\nimport Panzoom from \"@panzoom/panzoom\";\nimport ButtonWheel from \"./components/ButtonWheel.svelte\";\nlet compiled = \"\";\nlet self;\n// TODO Global Point Size\nconst pointOffsetX = 8;\nconst pointOffsetY = 10;\nlet panzoom;\nlet panScale = 0;\nlet panX = 0;\nlet panY = 0;\nlet contextClick;\nonMount(() => {\n    panzoom = Panzoom(self, {\n        maxScale: 2,\n        contain: \"outside\",\n        setTransform: (elem, { scale, x, y }) => {\n            panScale = scale;\n            panX = x;\n            panY = y;\n            panzoom.setStyle(\"transform\", `scale(${scale}) translate(${x}px, ${y}px)`);\n        },\n    });\n    parent.addEventListener(\"wheel\", panzoom.zoomWithWheel);\n});\nconst generateTile = () => {\n    return {\n        definition: GetTileDefinition(\"Sum\"),\n        metadata: {\n            id: GenerateGUID(),\n            position: {\n                x: document.documentElement.clientWidth / 2,\n                y: document.documentElement.clientHeight / 2,\n            },\n        },\n    };\n};\nconst validConnecton = derived(drawnConnection, ($drawnConnection) => {\n    return $drawnConnection;\n});\nconst calculateBounds = (connection) => {\n    const conn = get(connection);\n    if (!conn || !conn.sourceTile || !conn.targetTile) {\n        return writable({\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            swap: false,\n        });\n    }\n    return derived([conn.sourceTile.tile, conn.targetTile.tile], ([sourceTile, targetTile]) => {\n        let left = Number.MAX_SAFE_INTEGER;\n        let right = 0;\n        let top = Number.MAX_SAFE_INTEGER;\n        let bottom = 0;\n        const sourceBounds = sourceTile.metadata.pinComponents[conn.sourceTile.pin.name].getBoundingClientRect();\n        const targetBounds = targetTile.metadata.pinComponents[conn.targetTile.pin.name].getBoundingClientRect();\n        left = Math.min(left, sourceBounds.x);\n        right = Math.max(right, sourceBounds.x);\n        top = Math.min(top, sourceBounds.y);\n        bottom = Math.max(bottom, sourceBounds.y);\n        left = Math.min(left, targetBounds.x);\n        right = Math.max(right, targetBounds.x);\n        top = Math.min(top, targetBounds.y);\n        bottom = Math.max(bottom, targetBounds.y);\n        const swap = !((left !== targetBounds.x && top !== targetBounds.y) ||\n            (right !== targetBounds.x && bottom !== targetBounds.y));\n        top -= pointOffsetY - 4;\n        const containerBB = self.getBoundingClientRect();\n        left -= containerBB.x;\n        right -= containerBB.x;\n        top -= containerBB.y;\n        bottom -= containerBB.y;\n        left /= panScale;\n        right /= panScale;\n        top /= panScale;\n        bottom /= panScale;\n        // TODO Fix zoom scaling for point offsets\n        left += pointOffsetX;\n        right += pointOffsetX;\n        top += pointOffsetY;\n        bottom += pointOffsetY;\n        return {\n            x: left,\n            y: top,\n            width: right - left,\n            height: bottom - top,\n            swap,\n        };\n    });\n};\nconst onRightClick = (event) => {\n    event.preventDefault();\n    let current = event.target;\n    while (current && !(\"ide_component\" in current)) {\n        current = current.parentElement;\n    }\n    if (!current) {\n        contextClick = undefined;\n    }\n    else {\n        contextClick = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            offsetX: event.offsetX,\n            offsetY: event.offsetY,\n            context: current.ide_component,\n        };\n    }\n};\n</script>\n\n<style>\n  :global(body) {\n    margin: 0;\n    background: rgb(36, 36, 36);\n    color: white;\n    font-family: \"Roboto\", sans-serif;\n  }\n\n  .App {\n    width: 100vw;\n    height: 100vh;\n  }\n\n  .HUD {\n    position: absolute;\n    z-index: 9999999999;\n  }\n\n  .Container {\n    width: 16000px;\n    height: 9000px;\n    outline: 3px solid rgb(156 156 156);\n    background: repeating-linear-gradient(\n        00deg,\n        rgba(0 0 0 / 0%),\n        rgba(0 0 0 / 0) 39px,\n        rgb(55, 55, 55) 0,\n        rgb(55, 55, 55) 40px\n      ),\n      repeating-linear-gradient(\n        90deg,\n        rgba(0 0 0 / 0%),\n        rgba(0 0 0 / 0) 39px,\n        rgb(55, 55, 55) 0,\n        rgb(55, 55, 55) 40px\n      );\n  }\n</style>\n\n<div class=\"App\" style=\"background-position: {panX}px {panY}px\">\n  <div class=\"HUD\">\n    <button on:click={() => tiles.add(generateTile())}>Add Draggable</button>\n    <button on:click={() => (compiled = Compile())}>Compile</button>\n    <button on:click={() => panzoom.zoom(0.9)}>0.90</button>\n    <br /> Total Draggables: {Object.values($tiles).length}\n    <br /> Scale: {panScale}\n    <br /> X: {panX}\n    <br /> Y: {panY}\n    <br />\n    <textarea cols=\"100\" rows=\"10\">{compiled}</textarea>\n  </div>\n\n  {#if contextClick}\n    <ButtonWheel point={contextClick} />\n  {/if}\n\n  <div class=\"Container\" bind:this={self} on:contextmenu={onRightClick}>\n    {#if $drawnConnection}\n      <DrawingConnection\n        connection={validConnecton}\n        offsetBB={self.getBoundingClientRect()}\n        scaling={panScale} />\n    {/if}\n\n    {#each Object.values($tiles) as tile}\n      <Draggable {tile} scaling={panScale} offsetX={panX} offsetY={panY} />\n    {/each}\n\n    {#each Object.values($connections) as connection}\n      <Connection bounds={calculateBounds(connection)} />\n    {/each}\n  </div>\n</div>\n"],"mappings":"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"}